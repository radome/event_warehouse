language: ruby
dist: xenial
services: mysql
bundler_args: "--without deployment"
cache:
  bundler: true
before_script:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
- bundle exec rake db:create
script:
- bundle exec rubocop
- bundle exec rspec
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
before_deploy: "./compile-build"
deploy:
  provider: releases
  file_glob: true
  skip_cleanup: true
  file: release.tar.gz
  on:
    tags: true
    repo: sanger/event_warehouse
  api_key:
    secure: k0iWgaY5Hz8s0YMaf1jajMtK8JzUFuF1d3y2xkApNmuatHf9+zqWLbx1h3gF3AxhGLeM8i9Z7lnQi9oHUmmHhE5Y+lx7wAwW83YClgv98T8HT8sRUw9v0/HklX71rJPDatiwtzmaEmNN1bKUs38Knpe5yfO14ozQr+YHY3hp9J9XDBa5vlQRtS7AKVJfxY4AcSAdt5qqb5KNDvCDBXP5xoLoEmT0AKGHDXaBlKwFcG66UXxTPg8r9Uvqz5orLmci+yhPAS7EV5BL9uhgmUU0VmdQD2kpoejlvhCiC2VA22xYl3jiXJ8SXuTLM9voTZs5aqM6FNNBqnXwR+YboXOrAKEvA8RZ48I2/B88pI3V12rP8MQBBiv42ue6D4u+v2mF08t27vKZ53zLQ1i66LOjS07hJ8jYF8xW2/ElbUhsd4wafV9qTqwM1AgSKj74Gl12kXT8c/rxLrGTMsfPvY21UAVjOEeLE6j1zG1f/aalE5zVukRFaoQIHPjMkfkKaPE6XyszFyPcFbEhbp7i4r+bY8knQs78SS+wg7F8OdD0+TkLgVOa1lTmxfVizAlc8+Y1chfqsqdDu8bY1pVdwM9g3w/gSNSAKJstfL9PIWvvSQF49wy0xrv1+xM1AsfwMaN8vkL76nlf1D8CVoWk/b3KbcAJ81OtPF5eM/j/X6Kb9kI=
